CREATE DATABASE amazon_project;
USE amazon_project;

CREATE TABLE Customers (
customer_id INT PRIMARY KEY,
name VARCHAR(100),
email VARCHAR(100) UNIQUE,
location VARCHAR(100)
);


INSERT INTO Customers VALUES
(1,'Amit Sharma','amit.sharma@example.com','Mumbai'),
(2,'Priya Mehta','priya.mehta@example.com','Delhi'),
(3,'Rohit Verma','rohit.verma@example.com','Bangalore'),
(4,'Sneha Patil','sneha.patil@example.com','Pune'),
(5,'Arjun Singh','arjun.singh@example.com','Chennai'),
(6,'Kiran Nair','kiran.nair@example.com','Kochi'),
(7,'Vikram Rao','vikram.rao@example.com','Hyderabad'),
(8,'Meera Joshi','meera.joshi@example.com','Ahmedabad'),
(9,'Suresh Iyer','suresh.iyer@example.com','Kolkata'),
(10,'Ritika Kapoor','ritika.kapoor@example.com','Jaipur'),
(11,'Anil Kumar','anil.kumar@example.com','Lucknow'),
(12,'Neha Desai','neha.desai@example.com','Nagpur'),
(13,'Varun Malhotra','varun.malhotra@example.com','Indore'),
(14,'Pooja Reddy','pooja.reddy@example.com','Vizag'),
(15,'Deepak Chauhan','deepak.chauhan@example.com','Surat');

Select * from Customers;

CREATE TABLE Products (
product_id INT PRIMARY KEY,
name VARCHAR(150),
category VARCHAR(100),
price DECIMAL(10,2),
stock INT
);

INSERT INTO Products VALUES
(1,'iPhone 14','Electronics',79999,10),
(2,'Samsung Galaxy S23','Electronics',74999,8),
(3,'Sony Headphones','Electronics',5999,20),
(4,'HP Laptop','Computers',55999,12),
(5,'Lenovo ThinkPad','Computers',65999,5),
(6,'Nike Shoes','Fashion',4999,15),
(7,'Adidas Jacket','Fashion',3499,7),
(8,'Levi''s Jeans','Fashion',2999,25),
(9,'Apple Watch','Electronics',39999,6),
(10,'Samsung Tablet','Electronics',24999,10),
(11,'Fastrack Watch','Fashion',1999,18),
(12,'Sony TV','Electronics',89999,3),
(13,'LG Refrigerator','Home Appliances',45999,4),
(14,'Philips Mixer','Home Appliances',3999,9),
(15,'Prestige Cooker','Home Appliances',2999,11);

Select * from Products;

CREATE TABLE Orders (
order_id INT PRIMARY KEY,
customer_id INT,
order_date DATE,
status VARCHAR(50),
total_amount DECIMAL(10,2)
);

INSERT INTO Orders VALUES
(1,1,'2025-08-01','Delivered',79999),
(2,2,'2025-08-02','Delivered',74999),
(3,3,'2025-08-03','Delivered',5999),
(4,4,'2025-08-04','Shipped',55999),
(5,5,'2025-08-05','Delivered',65999),
(6,6,'2025-08-06','Cancelled',4999),
(7,7,'2025-08-07','Delivered',3499),
(8,8,'2025-08-08','Delivered',2999),
(9,9,'2025-08-09','Delivered',39999),
(10,10,'2025-08-10','Pending',24999),
(11,11,'2025-08-11','Delivered',1999),
(12,12,'2025-08-12','Delivered',89999),
(13,13,'2025-08-13','Delivered',45999),
(14,14,'2025-08-14','Shipped',3999),
(15,15,'2025-08-15','Delivered',2999);

UPDATE orders SET status = 'cancelled' WHERE order_id =7;
Select * from Orders;

CREATE TABLE OrderDetails (
detail_id INT PRIMARY KEY,
order_id INT,
product_id INT,
quantity INT,
subtotal DECIMAL(10,2)
);

SELECT * FROM OrderDetails;

INSERT INTO OrderDetails VALUES
(1,1,1,1,79999),
(2,2,2,1,74999),
(3,3,3,1,5999),
(4,4,4,1,55999),
(5,5,5,1,65999),
(6,6,6,1,4999),
(7,7,7,1,3499),
(8,8,8,1,2999),
(9,9,9,1,39999),
(10,10,10,1,24999),
(11,11,11,1,1999),
(12,12,12,1,89999),
(13,13,13,1,45999),
(14,14,14,1,3999),
(15,15,15,1,2999);

UPDATE OrderDetails
SET quantity = 5
WHERE detail_id = 3;

Select * from OrderDetails;

CREATE TABLE Reviews (
review_id INT PRIMARY KEY,
customer_id INT,
product_id INT,
rating INT,
review_text VARCHAR(255)
);

INSERT INTO Reviews VALUES
(1,1,1,5,'Excellent phone! Worth the price.'),
(2,2,2,4,'Great features, but a bit pricey.'),
(3,3,3,5,'Amazing sound quality.'),
(4,4,4,4,'Good laptop for work.'),
(5,5,5,5,'Excellent performance.'),
(6,6,6,3,'Comfortable but expensive.'),
(7,7,7,4,'Stylish and warm.'),
(8,8,8,5,'Perfect fitting jeans.'),
(9,9,9,5,'Great smartwatch with health features.'),
(10,10,10,4,'Good tablet for students.'),
(11,11,11,3,'Decent watch for the price.'),
(12,12,12,5,'Fantastic TV, crystal clear.'),
(13,13,13,4,'Spacious and energy efficient.'),
(14,14,14,5,'Very useful in the kitchen.'),
(15,15,15,4,'Durable and good quality.');

Select * from Reviews;

-- 1. Find top 5 best-selling products by total sales
SELECT p.name, SUM(od.quantity) AS total_sold
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
GROUP BY p.name
ORDER BY total_sold DESC
LIMIT 5;

-- 2. Find total revenue generated by each category
SELECT p.category, SUM(od.subtotal) AS revenue
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
GROUP BY p.category
ORDER BY revenue DESC;

-- 3. Find top 5 customers by total spending
SELECT c.name, SUM(o.total_amount) AS total_spent
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
GROUP BY c.name
ORDER BY total_spent DESC
LIMIT 5;

-- 4. Find average rating of each product
SELECT p.name, AVG(r.rating) AS avg_rating
FROM Reviews r
JOIN Products p ON r.product_id = p.product_id
GROUP BY p.name
ORDER BY avg_rating DESC LIMIT 10;


-- 5. Low stock products (decision: restock needed)
SELECT name, stock
FROM Products
WHERE stock < 6
ORDER BY stock ASC;

-- 6 Most Cancelled Orders
SELECT p.name AS product_name, COUNT(o.order_id) AS cancelled_count
FROM Orders o
JOIN OrderDetails od ON o.order_id = od.order_id
JOIN Products p ON od.product_id = p.product_id
WHERE o.status = 'Cancelled'
GROUP BY p.name
ORDER BY cancelled_count DESC;

-- 7 Customer Loyalty (Order Count per Customer)
SELECT c.name, COUNT(o.order_id) AS order_count
FROM Orders o
JOIN Customers c ON o.customer_id = c.customer_id
GROUP BY c.name
ORDER BY order_count DESC;     -- Currently, no customer is a repeat buyer. This highlights a business problem: we need to encourage repeat purchases with loyalty programs

-- 8 Which categories bring higher order value?
SELECT p.category, ROUND(AVG(od.subtotal),2) AS avg_order_value
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
GROUP BY p.category  
ORDER BY avg_order_value DESC;

-- 9 Highest Rated Category
SELECT p.category, ROUND(AVG(r.rating),2) AS avg_rating
FROM Reviews r
JOIN Products p ON r.product_id = p.product_id
GROUP BY p.category
ORDER BY avg_rating DESC;

-- 10 Top Products by Revenue
SELECT p.name, SUM(od.subtotal) AS total_revenue
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
GROUP BY p.name
ORDER BY total_revenue DESC
LIMIT 5;

-- How do products rank overall based on units sold?
SELECT 
    p.name AS product_name,
    SUM(od.quantity) AS total_sold,
    row_number() OVER (ORDER BY SUM(od.quantity) DESC) AS sales_rank
FROM OrderDetails od
JOIN Products p ON od.product_id = p.product_id
GROUP BY p.name;



SELECT P.Stock from Products P
WHERE P.Stock > ( select AVG(stock) from Products where stock=p.stock);